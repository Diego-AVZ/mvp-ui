<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowFi - Interactive DeFi Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@1.3.0/dist/chartjs-plugin-zoom.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            overflow-x: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            padding: 1rem 2rem;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-links a {
            color: #888;
            text-decoration: none;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #00d4ff;
        }

        .main-container {
            display: flex;
            height: calc(100vh - 80px);
        }

        .chart-container {
            flex: 1;
            position: relative;
            background: #0a0a0a;
            height: calc(100% - 80px);
        }

        .chart-header {
            padding: 1rem 2rem;
            background: #1a1a1a;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .pair-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .pair-name {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .price {
            font-size: 1.5rem;
            font-weight: 700;
            color: #00ff88;
        }

        .price-change {
            font-size: 0.9rem;
            color: #00ff88;
        }

        .liquidity-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(0, 212, 255, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s;
        }

        .liquidity-info:hover {
            background: rgba(0, 212, 255, 0.2);
            border-color: rgba(0, 212, 255, 0.5);
        }

        .info-icon {
            width: 20px;
            height: 20px;
            background: #00d4ff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .liquidity-range {
            font-size: 0.9rem;
            color: #00d4ff;
        }

        .timeframe-selector {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .timeframe-btn {
            background: #2a2a2a;
            border: 1px solid #444;
            color: #888;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .timeframe-btn:hover {
            background: #333;
            border-color: #555;
            color: #fff;
        }

        .timeframe-btn.active {
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            border-color: #00d4ff;
            color: white;
        }

        .open-range-btn {
            background: linear-gradient(135deg, #00ff88 0%, #00cc66 100%);
            border: 1px solid #00ff88;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-left: 1rem;
        }

        .open-range-btn:hover {
            background: linear-gradient(135deg, #00ff88 0%, #00cc66 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.3);
        }

        .chart-container.range-tool-active {
            cursor: crosshair;
        }

        .chart-container:hover {
            opacity: 0.95;
        }

        #btcChart {
            width: 100%;
            height: 100%;
        }

        .liquidity-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 10;
        }

        .liquidity-range-indicator {
            pointer-events: auto;
            cursor: pointer;
        }

        .liquidity-range-indicator {
            position: absolute;
            right: 20px;
            bottom: 20px;
            background: rgba(0, 212, 255, 0.15);
            border: 2px solid #00d4ff;
            border-radius: 12px;
            padding: 1.5rem;
            color: #00d4ff;
            font-weight: 600;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 212, 255, 0.2);
            animation: pulse 2s infinite;
            transition: all 0.3s ease;
            z-index: 20;
        }

        .liquidity-range-indicator:hover {
            background: rgba(0, 212, 255, 0.25);
            border-color: #00d4ff;
            box-shadow: 0 12px 40px rgba(0, 212, 255, 0.4);
            transform: translateY(-50%) scale(1.05);
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 8px 32px rgba(0, 212, 255, 0.2);
            }
            50% {
                box-shadow: 0 8px 32px rgba(0, 212, 255, 0.4);
            }
            100% {
                box-shadow: 0 8px 32px rgba(0, 212, 255, 0.2);
            }
        }

        .range-label {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .range-values {
            font-size: 1.1rem;
            font-weight: 700;
        }


        .sidebar {
            width: 350px;
            background: #1a1a1a;
            border-left: 1px solid #333;
            padding: 2rem;
            overflow-y: auto;
        }

        .sidebar-section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #00d4ff;
        }

        .position-card {
            background: #2a2a2a;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #333;
            margin-bottom: 1rem;
        }

        .position-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .position-type {
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .position-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: #00ff88;
        }

        .position-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .detail-item {
            text-align: center;
        }

        .detail-label {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 0.25rem;
        }

        .detail-value {
            font-size: 0.9rem;
            font-weight: 600;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            flex: 1;
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.3);
        }

        .btn-secondary {
            background: #333;
            color: white;
            border: 1px solid #555;
        }

        .btn-secondary:hover {
            background: #444;
            border-color: #666;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 68, 68, 0.3);
        }

        .input-group {
            margin-bottom: 1rem;
        }

        .input-label {
            display: block;
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 0.5rem;
        }

        .input-field {
            width: 100%;
            padding: 0.75rem;
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            color: white;
            font-size: 1rem;
        }

        .input-field:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1a1a1a;
            border-radius: 16px;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            border: 1px solid #333;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #00d4ff;
        }

        .close-btn {
            background: none;
            border: none;
            color: #888;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.25rem;
        }

        .close-btn:hover {
            color: white;
        }

        .modal-body {
            margin-bottom: 1.5rem;
        }

        .modal-footer {
            display: flex;
            gap: 1rem;
        }

        .range-tool-info {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            color: #00d4ff;
        }

        .range-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .range-inputs {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .range-preview {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 1.5rem;
            border: 1px solid #333;
        }

        .preview-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #333;
        }

        .preview-item:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }

        .preview-label {
            color: #888;
            font-size: 0.9rem;
        }

        .preview-value {
            color: #00ff88;
            font-weight: 600;
            font-size: 1rem;
        }

        .position-summary {
            margin-bottom: 2rem;
        }

        .summary-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 1px solid #333;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .summary-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .summary-icon {
            font-size: 1.5rem;
        }

        .summary-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #00d4ff;
        }

        .summary-details {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
        }

        .summary-item {
            text-align: center;
            padding: 0.75rem;
            background: rgba(0, 212, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(0, 212, 255, 0.2);
        }

        .summary-label {
            display: block;
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 0.25rem;
        }

        .summary-value {
            font-size: 1rem;
            font-weight: 600;
            color: #00ff88;
        }

        .input-section, .preview-section {
            flex: 1;
        }

        .section-subtitle {
            font-size: 1rem;
            font-weight: 600;
            color: #00d4ff;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #333;
        }

        .fees-earned {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1) 0%, rgba(0, 255, 136, 0.05) 100%);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .fees-amount {
            font-size: 1.5rem;
            font-weight: 700;
            color: #00ff88;
            margin-bottom: 0.5rem;
        }

        .fees-label {
            font-size: 0.9rem;
            color: #888;
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .chart-container {
                height: 60vh;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">FlowFi</div>
        <nav class="nav-links">
            <a href="#dashboard">Dashboard</a>
            <a href="#strategies">Strategies</a>
            <a href="#funds">Funds</a>
            <a href="#portfolio">Portfolio</a>
        </nav>
    </header>

    <div class="main-container">
        <div class="chart-container">
            <div class="chart-header">
                <div class="pair-info">
                    <div class="pair-name">BTC/USDT</div>
                    <div class="price">$116,250.45</div>
                    <div class="price-change">+2.34%</div>
                </div>
                <div class="timeframe-selector">
                    <button class="timeframe-btn" data-timeframe="1h">1H</button>
                    <button class="timeframe-btn" data-timeframe="4h">4H</button>
                    <button class="timeframe-btn active" data-timeframe="1d">1D</button>
                    <button class="timeframe-btn" data-timeframe="1w">1W</button>
                    <button class="timeframe-btn" data-timeframe="1M">1M</button>
                    <button class="open-range-btn" onclick="openRangeTool()">Open Range</button>
                </div>
                <div class="liquidity-info" onclick="openModal()">
                    <div class="info-icon">i</div>
                    <div class="liquidity-range">LP Range: $112,000 - $120,000</div>
                </div>
            </div>
            <canvas id="btcChart"></canvas>
            <div class="liquidity-overlay">
                <div class="liquidity-range-indicator" onclick="openModal()">
                    <div class="range-label">LP Range</div>
                    <div class="range-values">$112K - $120K</div>
                    <div style="font-size: 0.8rem; margin-top: 0.5rem; opacity: 0.8;">Click to manage</div>
                </div>
            </div>
        </div>

        <div class="sidebar">
            <div class="sidebar-section">
                <h3 class="section-title">Active Positions</h3>
                
                <div class="position-card">
                    <div class="position-header">
                        <div class="position-type">Uniswap V3 LP</div>
                        <div class="position-value">$15,420.50</div>
                    </div>
                    
                    <div class="position-details">
                        <div class="detail-item">
                            <div class="detail-label">Range</div>
                            <div class="detail-value">$112K - $120K</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">APR</div>
                            <div class="detail-value">24.5%</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Fees Earned</div>
                            <div class="detail-value">$342.80</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Status</div>
                            <div class="detail-value" style="color: #00ff88;">Active</div>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="openModal()">Manage</button>
                        <button class="btn btn-secondary">View Details</button>
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <h3 class="section-title">Quick Actions</h3>
                
                <div class="input-group">
                    <label class="input-label">Add Liquidity (USDC)</label>
                    <input type="number" class="input-field" placeholder="0.00" id="liquidityAmount">
                </div>
                
                <button class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;" onclick="addLiquidity()">
                    Deposit USDC
                </button>
                
                <button class="btn btn-danger" style="width: 100%;" onclick="withdrawLiquidity()">
                    Withdraw Liquidity
                </button>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="liquidityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">BTC/USDT Liquidity Position</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="fees-earned">
                    <div class="fees-amount">$342.80</div>
                    <div class="fees-label">Fees Earned</div>
                </div>
                
                <div class="input-group">
                    <label class="input-label">Add Liquidity (USDC)</label>
                    <input type="number" class="input-field" placeholder="0.00" id="modalLiquidityAmount">
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="claimFees()">Claim Fees</button>
                <button class="btn btn-primary" onclick="addLiquidityFromModal()">Deposit USDC</button>
                <button class="btn btn-danger" onclick="withdrawLiquidityFromModal()">Withdraw</button>
            </div>
        </div>
    </div>

    <!-- Open Range Modal -->
    <div id="openRangeModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3 class="modal-title">ðŸš€ Create New Liquidity Position</h3>
                <button class="close-btn" onclick="closeRangeModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="position-summary">
                    <div class="summary-card">
                        <div class="summary-header">
                            <span class="summary-icon">ðŸ“Š</span>
                            <span class="summary-title">BTC/USDT Position</span>
                        </div>
                        <div class="summary-details">
                            <div class="summary-item">
                                <span class="summary-label">Range:</span>
                                <span class="summary-value" id="summaryRange">$0 - $0</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">Current Price:</span>
                                <span class="summary-value">$116,250</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">Status:</span>
                                <span class="summary-value" id="summaryStatus">Out of Range</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="range-selection">
                    <div class="range-inputs">
                        <div class="input-section">
                            <h4 class="section-subtitle">ðŸ’° Position Details</h4>
                            <div class="input-group">
                                <label class="input-label">Lower Price (USDC)</label>
                                <input type="number" class="input-field" id="lowerPrice" placeholder="0.00">
                            </div>
                            <div class="input-group">
                                <label class="input-label">Upper Price (USDC)</label>
                                <input type="number" class="input-field" id="upperPrice" placeholder="0.00">
                            </div>
                            <div class="input-group">
                                <label class="input-label">Liquidity Amount (USDC)</label>
                                <input type="number" class="input-field" id="modalLiquidityAmount" placeholder="0.00">
                            </div>
                        </div>
                        
                        <div class="preview-section">
                            <h4 class="section-subtitle">ðŸ“ˆ Projections</h4>
                            <div class="range-preview">
                                <div class="preview-item">
                                    <span class="preview-label">Price Range:</span>
                                    <span class="preview-value" id="priceRangePreview">$0 - $0</span>
                                </div>
                                <div class="preview-item">
                                    <span class="preview-label">Estimated Fees (24h):</span>
                                    <span class="preview-value" id="estimatedFees">$0.00</span>
                                </div>
                                <div class="preview-item">
                                    <span class="preview-label">APR:</span>
                                    <span class="preview-value" id="estimatedAPR">0%</span>
                                </div>
                                <div class="preview-item">
                                    <span class="preview-label">Range Width:</span>
                                    <span class="preview-value" id="rangeWidth">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="clearRangeSelection()">ðŸ”„ Clear Selection</button>
                <button class="btn btn-primary" onclick="createLiquidityPosition()">âœ¨ Create Position</button>
            </div>
        </div>
    </div>

    <script>
        // Chart.js Configuration
        let btcChart;
        let currentTimeframe = '1d';
        let rangeStartDate = null; // When the liquidity range was activated
        let isRangeToolActive = false;
        let selectedRange = { lower: null, upper: null };
        
        // Generate mock data for BTC/USDT based on timeframe
        function generateMockData(timeframe = '1d') {
            const data = [];
            const labels = [];
            const now = new Date();
            
            let dataPoints, timeInterval, basePrice, volatility;
            
            switch(timeframe) {
                case '1h':
                    dataPoints = 168; // 7 days * 24 hours
                    timeInterval = 60 * 60 * 1000; // 1 hour in ms
                    basePrice = 116000;
                    volatility = 2000;
                    break;
                case '4h':
                    dataPoints = 168; // 28 days * 6 periods per day
                    timeInterval = 4 * 60 * 60 * 1000; // 4 hours in ms
                    basePrice = 116000;
                    volatility = 3000;
                    break;
                case '1d':
                    dataPoints = 365; // 1 year
                    timeInterval = 24 * 60 * 60 * 1000; // 1 day in ms
                    basePrice = 116000;
                    volatility = 5000;
                    break;
                case '1w':
                    dataPoints = 104; // 2 years
                    timeInterval = 7 * 24 * 60 * 60 * 1000; // 1 week in ms
                    basePrice = 116000;
                    volatility = 8000;
                    break;
                case '1M':
                    dataPoints = 60; // 5 years
                    timeInterval = 30 * 24 * 60 * 60 * 1000; // 1 month in ms
                    basePrice = 116000;
                    volatility = 15000;
                    break;
            }
            
            for (let i = dataPoints; i >= 0; i--) {
                const date = new Date(now.getTime() - i * timeInterval);
                
                // Format labels based on timeframe
                let label;
                switch(timeframe) {
                    case '1h':
                        label = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                        break;
                    case '4h':
                        label = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                        break;
                    case '1d':
                        label = date.toLocaleDateString();
                        break;
                    case '1w':
                        label = date.toLocaleDateString();
                        break;
                    case '1M':
                        label = date.toLocaleDateString('en-US', {month: 'short', year: 'numeric'});
                        break;
                }
                
                labels.push(label);
                
                // Generate realistic BTC price data with trend
                const trend = Math.sin(i / dataPoints * Math.PI * 4) * 0.1; // Long-term trend
                const randomVariation = (Math.random() - 0.5) * volatility;
                const price = basePrice * (1 + trend) + randomVariation;
                
                data.push(Math.max(price, 10000)); // Minimum price floor
            }
            
            return { data, labels };
        }

        // Initialize Chart.js
        function initChart() {
            const ctx = document.getElementById('btcChart').getContext('2d');
            const { data, labels } = generateMockData(currentTimeframe);
            
            btcChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'BTC/USDT',
                        data: data,
                        borderColor: '#00ff88',
                        backgroundColor: 'rgba(0, 255, 136, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.1,
                        pointRadius: 0,
                        pointHoverRadius: 6,
                        pointHoverBackgroundColor: '#00ff88',
                        pointHoverBorderColor: '#ffffff',
                        pointHoverBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        zoom: {
                            zoom: {
                                wheel: {
                                    enabled: true,
                                    speed: 0.1
                                },
                                pinch: {
                                    enabled: true
                                },
                                mode: 'x',
                                limits: {
                                    x: {min: 'original', max: 'original'}
                                }
                            },
                            pan: {
                                enabled: true,
                                mode: 'x',
                                limits: {
                                    x: {min: -Infinity, max: Infinity}
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#00d4ff',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return `Price: $${context.parsed.y.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#888',
                                maxTicksLimit: 12
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#888',
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    onClick: function(event, elements) {
                        // Don't open modal on chart click - only on specific elements
                        return;
                    }
                },
                plugins: [{
                    id: 'liquidityLines',
                    afterDraw: function(chart) {
                        const ctx = chart.ctx;
                        const chartArea = chart.chartArea;
                        
                        // Set range start date to 5 days ago if not set
                        if (!rangeStartDate) {
                            rangeStartDate = new Date();
                            rangeStartDate.setDate(rangeStartDate.getDate() - 5);
                        }
                        
                        // Calculate the x position where the range starts
                        // For simplicity, let's use a fixed position (80% from the left)
                        const rangeStartX = chartArea.left + (chartArea.right - chartArea.left) * 0.2;
                        
                        ctx.save();
                        
                        // Always draw the existing liquidity range
                        // Draw liquidity range area (only from range start)
                        ctx.fillStyle = 'rgba(0, 212, 255, 0.05)';
                        ctx.fillRect(rangeStartX, chartArea.top, chartArea.right - rangeStartX, chartArea.bottom - chartArea.top);
                        
                        // Draw upper line ($120K) - only from range start
                        const upperY = chart.scales.y.getPixelForValue(120000);
                        ctx.strokeStyle = '#00d4ff';
                        ctx.lineWidth = 3;
                        ctx.setLineDash([5, 5]);
                        ctx.beginPath();
                        ctx.moveTo(rangeStartX, upperY);
                        ctx.lineTo(chartArea.right, upperY);
                        ctx.stroke();
                        
                        // Draw lower line ($112K) - only from range start
                        const lowerY = chart.scales.y.getPixelForValue(112000);
                        ctx.beginPath();
                        ctx.moveTo(rangeStartX, lowerY);
                        ctx.lineTo(chartArea.right, lowerY);
                        ctx.stroke();
                        
                        // Add labels with better positioning
                        ctx.fillStyle = '#00d4ff';
                        ctx.font = 'bold 12px Arial';
                        ctx.textAlign = 'right';
                        
                        // Upper label
                        ctx.fillRect(chartArea.right - 60, upperY - 15, 55, 20);
                        ctx.fillStyle = 'white';
                        ctx.fillText('$120K', chartArea.right - 5, upperY - 2);
                        
                        // Lower label
                        ctx.fillStyle = '#00d4ff';
                        ctx.fillRect(chartArea.right - 60, lowerY - 15, 55, 20);
                        ctx.fillStyle = 'white';
                        ctx.fillText('$112K', chartArea.right - 5, lowerY - 2);
                        
                        // Draw current price line ($116K) - always visible
                        const currentY = chart.scales.y.getPixelForValue(116000);
                        ctx.strokeStyle = '#00ff88';
                        ctx.lineWidth = 2;
                        ctx.setLineDash([]);
                        ctx.beginPath();
                        ctx.moveTo(chartArea.left, currentY);
                        ctx.lineTo(chartArea.right, currentY);
                        ctx.stroke();
                        
                        // Current price label
                        ctx.fillStyle = '#00ff88';
                        ctx.font = 'bold 12px Arial';
                        ctx.textAlign = 'right';
                        ctx.fillRect(chartArea.right - 60, currentY - 15, 55, 20);
                        ctx.fillStyle = 'white';
                        ctx.fillText('$116K', chartArea.right - 5, currentY - 2);
                        
                        ctx.restore();
                        
                        // Draw range tool selection if active
                        if (isRangeToolActive) {
                            ctx.save();
                            
                            if (selectedRange.lower && selectedRange.upper) {
                                // Draw selection area
                                const lowerY = chart.scales.y.getPixelForValue(selectedRange.lower);
                                const upperY = chart.scales.y.getPixelForValue(selectedRange.upper);
                                
                                // Fill selection area
                                ctx.fillStyle = 'rgba(0, 255, 136, 0.1)';
                                ctx.fillRect(chartArea.left, upperY, chartArea.right - chartArea.left, lowerY - upperY);
                                
                                // Draw selection lines
                                ctx.strokeStyle = '#00ff88';
                                ctx.lineWidth = 3;
                                ctx.setLineDash([]);
                                
                                ctx.beginPath();
                                ctx.moveTo(chartArea.left, lowerY);
                                ctx.lineTo(chartArea.right, lowerY);
                                ctx.moveTo(chartArea.left, upperY);
                                ctx.lineTo(chartArea.right, upperY);
                                ctx.stroke();
                                
                                // Draw selection labels
                                ctx.fillStyle = '#00ff88';
                                ctx.font = 'bold 12px Arial';
                                ctx.textAlign = 'left';
                                
                                // Lower label
                                ctx.fillRect(chartArea.left + 10, lowerY - 15, 60, 20);
                                ctx.fillStyle = 'white';
                                ctx.fillText(`$${selectedRange.lower.toFixed(0)}`, chartArea.left + 15, lowerY - 2);
                                
                                // Upper label
                                ctx.fillStyle = '#00ff88';
                                ctx.fillRect(chartArea.left + 10, upperY - 15, 60, 20);
                                ctx.fillStyle = 'white';
                                ctx.fillText(`$${selectedRange.upper.toFixed(0)}`, chartArea.left + 15, upperY - 2);
                                
                                // Draw "Select This Range" button
                                const buttonY = (lowerY + upperY) / 2;
                                ctx.fillStyle = 'rgba(0, 255, 136, 0.9)';
                                ctx.fillRect(chartArea.left + 10, buttonY - 15, 120, 30);
                                ctx.fillStyle = 'white';
                                ctx.font = 'bold 11px Arial';
                                ctx.textAlign = 'center';
                                ctx.fillText('Select This Range', chartArea.left + 70, buttonY + 2);
                            } else if (selectedRange.lower) {
                                // Draw single line for lower price
                                const lowerY = chart.scales.y.getPixelForValue(selectedRange.lower);
                                ctx.strokeStyle = '#00ff88';
                                ctx.lineWidth = 2;
                                ctx.setLineDash([5, 5]);
                                ctx.beginPath();
                                ctx.moveTo(chartArea.left, lowerY);
                                ctx.lineTo(chartArea.right, lowerY);
                                ctx.stroke();
                                
                                // Draw label
                                ctx.fillStyle = '#00ff88';
                                ctx.font = 'bold 12px Arial';
                                ctx.textAlign = 'left';
                                ctx.fillRect(chartArea.left + 10, lowerY - 15, 60, 20);
                                ctx.fillStyle = 'white';
                                ctx.fillText(`$${selectedRange.lower.toFixed(0)}`, chartArea.left + 15, lowerY - 2);
                            }
                            
                            ctx.restore();
                        }
                    }
                }]
            });
            
            // Remove click event from chart container to allow zoom/pan
            const chartContainer = document.querySelector('.chart-container');
            
            // Add visual feedback
            chartContainer.addEventListener('mouseenter', function() {
                chartContainer.style.border = '2px solid rgba(0, 212, 255, 0.3)';
            });
            
            chartContainer.addEventListener('mouseleave', function() {
                chartContainer.style.border = 'none';
            });
            
            // Add timeframe button functionality
            setupTimeframeButtons();
        }
        
        // Setup timeframe buttons
        function setupTimeframeButtons() {
            const timeframeButtons = document.querySelectorAll('.timeframe-btn');
            
            timeframeButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation(); // Prevent event bubbling to chart
                    
                    // Remove active class from all buttons
                    timeframeButtons.forEach(btn => btn.classList.remove('active'));
                    
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    // Update current timeframe
                    currentTimeframe = this.dataset.timeframe;
                    
                    // Update chart with new data
                    updateChartTimeframe(currentTimeframe);
                });
            });
        }
        
        // Update chart with new timeframe data
        function updateChartTimeframe(timeframe) {
            const { data, labels } = generateMockData(timeframe);
            
            btcChart.data.labels = labels;
            btcChart.data.datasets[0].data = data;
            btcChart.update('active');
        }

        // Register zoom plugin
        Chart.register(ChartZoom);

        // Initialize chart when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initChart();
        });

        // Modal functions
        function openModal() {
            document.getElementById('liquidityModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('liquidityModal').style.display = 'none';
        }

        // Open Range Tool functions
        function openRangeTool() {
            isRangeToolActive = !isRangeToolActive;
            
            if (isRangeToolActive) {
                // Change cursor to crosshair
                const chartContainer = document.querySelector('.chart-container');
                chartContainer.classList.add('range-tool-active');
                
                // Add click event to chart for range selection
                const canvas = document.getElementById('btcChart');
                canvas.addEventListener('click', handleRangeSelection);
                
                // Update button text
                const button = document.querySelector('.open-range-btn');
                button.textContent = 'Cancel Range';
                button.style.background = 'linear-gradient(135deg, #ff4444 0%, #cc0000 100%)';
                
                // Show tooltip
                showRangeTooltip();
            } else {
                // Deactivate tool
                const chartContainer = document.querySelector('.chart-container');
                chartContainer.classList.remove('range-tool-active');
                
                // Remove click event
                const canvas = document.getElementById('btcChart');
                canvas.removeEventListener('click', handleRangeSelection);
                
                // Reset selection
                selectedRange = { lower: null, upper: null };
                
                // Update button text
                const button = document.querySelector('.open-range-btn');
                button.textContent = 'Open Range';
                button.style.background = 'linear-gradient(135deg, #00ff88 0%, #00cc66 100%)';
                
                // Hide tooltip
                hideRangeTooltip();
            }
            
            // Update chart to show tool is active
            if (btcChart) {
                btcChart.update();
            }
        }

        function closeRangeModal() {
            document.getElementById('openRangeModal').style.display = 'none';
        }

        function handleRangeSelection(event) {
            if (!isRangeToolActive) return;
            
            const canvas = document.getElementById('btcChart');
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            // Check if clicking on "Select This Range" button
            if (selectedRange.lower && selectedRange.upper) {
                const chartArea = btcChart.chartArea;
                const lowerY = btcChart.scales.y.getPixelForValue(selectedRange.lower);
                const upperY = btcChart.scales.y.getPixelForValue(selectedRange.upper);
                const buttonY = (lowerY + upperY) / 2;
                
                // Check if click is on the button
                if (x >= chartArea.left + 10 && x <= chartArea.left + 130 && 
                    y >= buttonY - 15 && y <= buttonY + 15) {
                    selectCurrentRange();
                    return;
                }
            }
            
            // Convert pixel to value
            const value = btcChart.scales.y.getValueForPixel(y);
            
            if (!selectedRange.lower) {
                selectedRange.lower = value;
                updateTooltipText('Click again to select upper price');
            } else if (!selectedRange.upper) {
                selectedRange.upper = value;
                
                // Ensure lower < upper
                if (selectedRange.lower > selectedRange.upper) {
                    [selectedRange.lower, selectedRange.upper] = [selectedRange.upper, selectedRange.lower];
                }
                
                updateTooltipText('Click "Select This Range" to confirm');
            } else {
                // Reset selection
                selectedRange = { lower: value, upper: null };
                updateTooltipText('Click again to select upper price');
            }
            
            // Update chart
            btcChart.update();
        }

        function updateTooltipText(text) {
            const tooltip = document.getElementById('range-tooltip');
            if (tooltip) {
                tooltip.textContent = text;
            }
        }

        function selectCurrentRange() {
            if (!selectedRange.lower || !selectedRange.upper) return;
            
            // Show success message and open modal for final details
            const confirmed = confirm(`Range selected: $${selectedRange.lower.toFixed(2)} - $${selectedRange.upper.toFixed(2)}\n\nDo you want to create this liquidity position?`);
            
            if (confirmed) {
                // Open the modal with pre-filled data
                document.getElementById('openRangeModal').style.display = 'block';
                document.getElementById('lowerPrice').value = selectedRange.lower.toFixed(2);
                document.getElementById('upperPrice').value = selectedRange.upper.toFixed(2);
                
                // Add event listeners to inputs for real-time updates
                setupModalInputListeners();
                
                // Focus on liquidity amount input
                const liquidityInput = document.getElementById('modalLiquidityAmount');
                liquidityInput.focus();
                
                // Update preview
                updateRangePreview();
                
                // Deactivate tool
                openRangeTool();
            }
        }

        function setupModalInputListeners() {
            // Remove existing listeners to avoid duplicates
            const lowerInput = document.getElementById('lowerPrice');
            const upperInput = document.getElementById('upperPrice');
            const liquidityInput = document.getElementById('modalLiquidityAmount');
            
            // Remove old listeners
            lowerInput.removeEventListener('input', updateRangePreview);
            upperInput.removeEventListener('input', updateRangePreview);
            liquidityInput.removeEventListener('input', updateRangePreview);
            
            // Add new listeners
            lowerInput.addEventListener('input', updateRangePreview);
            upperInput.addEventListener('input', updateRangePreview);
            liquidityInput.addEventListener('input', updateRangePreview);
        }

        function showRangeTooltip() {
            // Create tooltip if it doesn't exist
            let tooltip = document.getElementById('range-tooltip');
            if (!tooltip) {
                tooltip = document.createElement('div');
                tooltip.id = 'range-tooltip';
                tooltip.style.cssText = `
                    position: absolute;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: rgba(0, 255, 136, 0.9);
                    color: white;
                    padding: 10px 20px;
                    border-radius: 8px;
                    font-weight: 600;
                    z-index: 1000;
                    pointer-events: none;
                    box-shadow: 0 4px 20px rgba(0, 255, 136, 0.3);
                `;
                tooltip.textContent = 'Click on chart to select price range';
                document.querySelector('.chart-container').appendChild(tooltip);
            }
            tooltip.style.display = 'block';
        }

        function hideRangeTooltip() {
            const tooltip = document.getElementById('range-tooltip');
            if (tooltip) {
                tooltip.style.display = 'none';
            }
        }

        function updateRangePreview() {
            // Try to get values from selectedRange first, then from inputs
            let lower, upper;
            
            if (selectedRange.lower && selectedRange.upper) {
                lower = selectedRange.lower;
                upper = selectedRange.upper;
            } else {
                lower = parseFloat(document.getElementById('lowerPrice').value);
                upper = parseFloat(document.getElementById('upperPrice').value);
            }
            
            if (!lower || !upper) return;
            
            const liquidityAmount = parseFloat(document.getElementById('modalLiquidityAmount').value) || 0;
            
            // Update price range preview
            const rangeText = `$${lower.toFixed(2)} - $${upper.toFixed(2)}`;
            document.getElementById('priceRangePreview').textContent = rangeText;
            document.getElementById('summaryRange').textContent = rangeText;
            
            // Calculate range width percentage
            const currentPrice = 116000;
            const rangeWidth = ((upper - lower) / currentPrice) * 100;
            document.getElementById('rangeWidth').textContent = `${rangeWidth.toFixed(1)}%`;
            
            // Check if current price is in range
            const isInRange = currentPrice >= lower && currentPrice <= upper;
            const statusText = isInRange ? 'In Range' : 'Out of Range';
            const statusColor = isInRange ? '#00ff88' : '#ff4444';
            document.getElementById('summaryStatus').textContent = statusText;
            document.getElementById('summaryStatus').style.color = statusColor;
            
            // Calculate estimated fees (simplified calculation)
            let estimatedFees = 0;
            let apr = 0;
            
            if (liquidityAmount > 0) {
                // Simplified fee calculation (0.3% of volume)
                const dailyVolume = liquidityAmount * 0.1; // Assume 10% daily volume
                estimatedFees = dailyVolume * 0.003; // 0.3% fee
                apr = (estimatedFees * 365 / liquidityAmount) * 100;
                
                // Adjust APR based on range width (narrower ranges = higher APR)
                if (rangeWidth < 5) apr *= 1.5; // Narrow range bonus
                else if (rangeWidth > 20) apr *= 0.7; // Wide range penalty
            }
            
            document.getElementById('estimatedFees').textContent = `$${estimatedFees.toFixed(2)}`;
            document.getElementById('estimatedAPR').textContent = `${apr.toFixed(2)}%`;
        }

        function clearRangeSelection() {
            selectedRange = { lower: null, upper: null };
            document.getElementById('lowerPrice').value = '';
            document.getElementById('upperPrice').value = '';
            document.getElementById('modalLiquidityAmount').value = '';
            document.getElementById('priceRangePreview').textContent = '$0 - $0';
            document.getElementById('estimatedFees').textContent = '$0.00';
            document.getElementById('estimatedAPR').textContent = '0%';
            
            // Deactivate tool
            if (isRangeToolActive) {
                openRangeTool();
            }
            
            if (btcChart) {
                btcChart.update();
            }
        }

        function createLiquidityPosition() {
            // Check if modal is visible
            const modal = document.getElementById('openRangeModal');
            if (!modal || modal.style.display === 'none') {
                alert('Modal is not visible. Please try again.');
                return;
            }
            
            // Read values from inputs instead of relying on selectedRange
            const lowerPrice = parseFloat(document.getElementById('lowerPrice').value);
            const upperPrice = parseFloat(document.getElementById('upperPrice').value);
            
            // Get liquidity amount from the modal specifically
            let liquidityAmount;
            const modalLiquidityElement = document.querySelector('#openRangeModal input[type="number"]:last-of-type');
            if (modalLiquidityElement) {
                liquidityAmount = parseFloat(modalLiquidityElement.value);
                console.log('Using modal liquidity element:', modalLiquidityElement.value, 'ID:', modalLiquidityElement.id);
            } else {
                // Try the specific ID
                const liquidityElement = document.getElementById('modalLiquidityAmount');
                if (liquidityElement) {
                    liquidityAmount = parseFloat(liquidityElement.value);
                    console.log('Using modalLiquidityAmount ID:', liquidityElement.value);
                } else {
                    liquidityAmount = NaN;
                    console.log('No liquidity element found in modal');
                }
            }
            
            // Debug: show values being read
            const modalInputs = document.querySelectorAll('#openRangeModal input');
            console.log('Values being read:', {
                lowerPrice: lowerPrice,
                upperPrice: upperPrice,
                liquidityAmount: liquidityAmount,
                lowerInput: document.getElementById('lowerPrice').value,
                upperInput: document.getElementById('upperPrice').value,
                modalInputsCount: modalInputs.length,
                modalInputs: Array.from(modalInputs).map(input => ({
                    id: input.id,
                    value: input.value,
                    placeholder: input.placeholder,
                    type: input.type
                })),
                sidebarLiquidityInput: document.getElementById('liquidityAmount') ? document.getElementById('liquidityAmount').value : 'NOT FOUND'
            });
            
            if (isNaN(lowerPrice) || isNaN(upperPrice) || lowerPrice <= 0 || upperPrice <= 0) {
                alert('Please enter valid prices (must be greater than 0)');
                return;
            }
            
            if (lowerPrice >= upperPrice) {
                alert('Lower price must be less than upper price');
                return;
            }
            
            if (isNaN(liquidityAmount) || liquidityAmount <= 0) {
                alert(`Please enter a valid liquidity amount (must be greater than 0)\n\nDebug info:\n- Raw value: "${liquidityElement ? liquidityElement.value : 'ELEMENT NOT FOUND'}"\n- Parsed value: ${liquidityAmount}\n- Element exists: ${!!liquidityElement}`);
                return;
            }
            
            // Create new position data
            const newPosition = {
                id: Date.now(),
                lower: lowerPrice,
                upper: upperPrice,
                amount: liquidityAmount,
                feesEarned: 0,
                apr: parseFloat(document.getElementById('estimatedAPR').textContent.replace('%', '')),
                status: 'Active',
                createdAt: new Date()
            };
            
            // Add to positions array
            if (!window.userPositions) {
                window.userPositions = [];
            }
            window.userPositions.push(newPosition);
            
            // Add to sidebar
            addPositionToSidebar(newPosition);
            
            // Show success message
            alert(`âœ… Position created successfully!\n\nRange: $${lowerPrice.toFixed(2)} - $${upperPrice.toFixed(2)}\nAmount: $${liquidityAmount}\nAPR: ${newPosition.apr.toFixed(2)}%`);
            
            closeRangeModal();
        }

        function addPositionToSidebar(position) {
            const sidebar = document.querySelector('.sidebar-section');
            const positionCard = document.createElement('div');
            positionCard.className = 'position-card';
            positionCard.id = `position-${position.id}`;
            
            positionCard.innerHTML = `
                <div class="position-header">
                    <div class="position-type">Uniswap V3 LP</div>
                    <div class="position-value">$${position.amount.toLocaleString()}</div>
                </div>
                
                <div class="position-details">
                    <div class="detail-item">
                        <div class="detail-label">Range</div>
                        <div class="detail-value">$${(position.lower/1000).toFixed(0)}K - $${(position.upper/1000).toFixed(0)}K</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">APR</div>
                        <div class="detail-value">${position.apr.toFixed(1)}%</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Fees Earned</div>
                        <div class="detail-value">$${position.feesEarned.toFixed(2)}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Status</div>
                        <div class="detail-value" style="color: #00ff88;">${position.status}</div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="managePosition(${position.id})">Manage</button>
                    <button class="btn btn-secondary" onclick="viewPositionDetails(${position.id})">Details</button>
                </div>
            `;
            
            // Insert after the first position card
            const firstCard = sidebar.querySelector('.position-card');
            if (firstCard) {
                sidebar.insertBefore(positionCard, firstCard.nextSibling);
            } else {
                sidebar.appendChild(positionCard);
            }
        }

        function managePosition(positionId) {
            const position = window.userPositions.find(p => p.id === positionId);
            if (position) {
                // Pre-fill modal with position data
                document.getElementById('lowerPrice').value = position.lower.toFixed(2);
                document.getElementById('upperPrice').value = position.upper.toFixed(2);
                document.getElementById('modalLiquidityAmount').value = position.amount;
                
                // Add event listeners to inputs for real-time updates
                setupModalInputListeners();
                
                // Update preview
                selectedRange = { lower: position.lower, upper: position.upper };
                updateRangePreview();
                
                // Open modal
                document.getElementById('openRangeModal').style.display = 'block';
            }
        }

        function viewPositionDetails(positionId) {
            const position = window.userPositions.find(p => p.id === positionId);
            if (position) {
                alert(`Position Details:\n\nRange: $${position.lower.toFixed(2)} - $${position.upper.toFixed(2)}\nAmount: $${position.amount.toLocaleString()}\nAPR: ${position.apr.toFixed(2)}%\nFees Earned: $${position.feesEarned.toFixed(2)}\nStatus: ${position.status}\nCreated: ${position.createdAt.toLocaleDateString()}`);
            }
        }

        // Action functions
        function claimFees() {
            alert('Fees claimed successfully! $342.80 has been added to your wallet.');
            closeModal();
        }

        function addLiquidity() {
            const amount = document.getElementById('liquidityAmount').value;
            if (amount && amount > 0) {
                alert(`Successfully added $${amount} USDC to your liquidity position!`);
                document.getElementById('liquidityAmount').value = '';
            } else {
                alert('Please enter a valid amount');
            }
        }

        function addLiquidityFromModal() {
            const amount = document.getElementById('modalLiquidityAmount').value;
            if (amount && amount > 0) {
                alert(`Successfully added $${amount} USDC to your liquidity position!`);
                document.getElementById('modalLiquidityAmount').value = '';
                closeModal();
            } else {
                alert('Please enter a valid amount');
            }
        }

        function withdrawLiquidity() {
            if (confirm('Are you sure you want to withdraw your liquidity? This will close your position.')) {
                alert('Liquidity withdrawn successfully! $15,420.50 has been returned to your wallet.');
            }
        }

        function withdrawLiquidityFromModal() {
            if (confirm('Are you sure you want to withdraw your liquidity? This will close your position.')) {
                alert('Liquidity withdrawn successfully! $15,420.50 has been returned to your wallet.');
                closeModal();
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('liquidityModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        // Simulate real-time price updates
        setInterval(() => {
            const priceElement = document.querySelector('.price');
            const currentPrice = parseFloat(priceElement.textContent.replace('$', '').replace(',', ''));
            const change = (Math.random() - 0.5) * 1000;
            const newPrice = currentPrice + change;
            priceElement.textContent = `$${newPrice.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
        }, 3000);
    </script>
</body>
</html>
